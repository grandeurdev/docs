---
title: Builing Your Custom JS App
---

# Builing Your Custom JS App

We've already accomplished the task of blinking the on-board LED of ESP8266 through our Grandeur Platform so let's take things one step further. Would'nt it be cool if we could control that LED using our custom app. 
That is exactly what we're going to build.

Just like the last time, make sure you're all set up by following this tutorial [here](/getting-started). 

## Get Started on Web

We are going to use theÂ [JavaScript SDK](https://github.com/grandeurtech/grandeurcloud-js-sdk)Â to integrate Grandeur into our app.
The first step is to create an application through which we will publish data to our device. Our app will contain two filesÂ `index.html`Â where we will design the layout of the page andÂ `main.js`Â where we will build the logic of page. 


## Web Application

Here's our index.html file in which we define our layout and style. 

```html
<!-- Index.html -->
<!DOCTYPE html>
<html>
	<!-- Head block of our page-->
	<head>
		<!-- Let's give our page a title-->
		<title>Internet Switch</title>

		<!-- Link SDK with CDN -->
		<script src="https://unpkg.com/grandeur-js"></script>
		<link rel="stylesheet" href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" />

		
	</head>

	<!-- Body block of our page-->
	<body>
		
		 
		<!-- The login page of our app -->
		
		<div id="login" class="min-h-screen bg-black text-white antialiased px-4 py-8 flex justify-center" style="display: none;">
			<!-- Card holds the form -->
			<div class="flex flex-col mt-32">

				<!-- The form to get email and passwordfrom users -->
				<div class="text-center text-white mb-3 text-xs">Login with the form below and then you can <br> list the devices paired to your account.</br></div>
				<input type="email" name="email" id="email" placeholder="Email" class=" sshadow-md bg-black w-96 h-5 px-3 
				py-5 mt-2 mr-2 focus:outline-none focus:ring-1 border  rounded-md" />
				<input type="password" name="password" id="password" placeholder="Password" class=" shadow-md bg-black w-96 h-5 px-3 
				py-5 mt-2 mr-2 focus:outline-none focus:ring-1 border focus:ring-white rounded-md" />
				
				<!-- Button to submit the form-->
				<button id="submitLogin" class=" bg-white w-96 h-10 text-black font-bold 
				px-3 py-2 mr-2 mt-4 rounded-md">Login</button>
			</div>
		</div>

		<!-- The page to hold the data -->
		<div id="devices" class="flex flex-col min-h-screen w-screen bg-black text-gray-800 antialiased " style="display: none;">
			<!-- The header of the page -->
			<div class="flex justify-between bg-gray-700 py-4 px-2 bg-2 flex-row ">
				<!-- Add toggleLED icon -->
				<button id="toggleLED" class="bg-black text-white font-bold 
				py-2 px-4 mr-72 rounded-full">Toggle Button</button>
				<!-- Add logout icon -->
				<button id="logout" class="bg-black text-white font-bold 
				py-2 px-4 rounded-full">Logout</button>
			</div>
		

			<!-- Holder for tiles -->

				<!-- Each div represents a tile  -->
				
		<div class="ml-16 mt-12 mb-12 flex flex-col font-bold place-content-center w-40 h-40 items-center pb-full rounded-xl color-amber-50" id="tile" >
			
				<div>Devices List</div> 
		
		</div> 
				
		</div>
	
			
		<!-- Main script file -->
		<script src="main.js"></script>
	</body>
</html>


```

We link the SDK using its CDN link and link our main script file. On the button click, we call the toggleLED() function which we'll define in our main.js file. Here's the main script:

```js


/**
 * @file: main.js
 * Initialize the SDK and get 
 * a reference to the project
*/

// Device ID and state
var deviceID = "devicel4qtnoaw1utz0pxfhhpshwd1";
var deviceState = null;

// Initialize the SDK and get
// a reference to the project
var project = grandeur.init("YOUR-API-KEY", "YOUR-ACCESS-KEY", "YOUR-ACCESS-TOKEN");
var LED = 0;
/** 
 * This function uses the sdk to validate
 * that if the user is authenticated or not
*/
async function start() {
	/** Use sdk auth class to check auth status */
	var res = await project.auth().isAuthenticated();

	/** Then if the user isn't authorized then show the login screen */
	if (res.code === "AUTH-UNAUTHORIZED") {
		return displayLogin();
	}

	/** Display devices screen */
	displayDevices();
	toggleLED();
}

async function loginn() {

	/** Get email and password from inputs */
	var email = document.getElementById("email").value;
	var password = document.getElementById("password").value;

	

	/** Use the sdk auth class to login the user */
	var res = await project.auth().login(email, password);

	/** If the operation was successful */
	if (res.code === "AUTH-ACCOUNT-LOGGEDIN") {
		/** Reset the login page */
		document.getElementById("email").value = "";
		document.getElementById("password").value = "";
		
		/** Display devices screen */
		return displayDevices();
		return toggleLED();
	}

	/** otherwise display the login screen again */
	displayLogin();
};


/** Listener on login form button to authenticate a user */
a=document.getElementById("submitLogin")
a.addEventListener("click", () => loginn ()); 

/** Function to get devices list from server and populate the ui*/
async function getDevicesList() {
	/** Use sdk devices class */
	var devices = await project.devices();
	var res = await devices.get();
	

	/** Variable to hold the ui */
	var content = "";

	/** Then loop over the devices list returned in response and populate the ui */
	for(const device of res.devices) {

		/** Add tile to the ui */
		content += `
			
				<div class=" ml-10 p-auto mt-24 flex flex-col text-white justify-center font-bold place-content-center w-72 h-72 items-center shadow-lg bg-gray-700 pb-full rounded-xl" id="${device.deviceID}" >
					<div class="text-center text-black items-center"> Device Name:</div>
					<div class="content-center font-light text-center"> ${device.name}</div>
					<div class="text-center text-black items-center"> Device Id: <br> </div>
					<div class="content-center font-light text-center"> ${device.deviceID}</div>
			   </div>
		`
		
	}
	/** Assign content to ui */
	document.getElementById("tile").innerHTML = content;
}

async function logoutt() {

	/** and use the auth class of sdk to logout the user */
	await project.auth().logout();

	/** Then call start again */
	start();
}

/** Add event handler on logout icon */
b=document.getElementById("logout");
b.addEventListener("click", () => logoutt() )


/** Function to show login screen */
function displayLogin() {
	

	/** Display login screen */
	document.getElementById("devices").style.display = "none";
	document.getElementById("login").style.display = "flex";
}

/** Function to show devices screen */
function displayDevices() {
	

	/** Display devices screen */
	document.getElementById("login").style.display = "none";
	document.getElementById("devices").style.display = "flex";

	/** Get devices list */
	getDevicesList();
	
}

/** Listener on login form button to toggle the LED authenticate a user */
c=document.getElementById("toggleLED")
c.addEventListener("click", () => toggleLED()); 


/*
    Function to send request
    to the server to toggle the LED
*/
async function toggleLED() {
    /*
        We will store the device id in a variable
        we generated this id while getting started
    */

    /* Then get a reference to device class */
    var devices = project.devices();

    /* and in a try catch block */
    try {
        /* Toggle LED variable */
		/** Display devices screen */
		document.getElementById("login").style.display = "none";
		document.getElementById("devices").style.display = "flex";

        LED = LED? 0: 1;

        /* Submit request to update state */
        var res = await devices.device(deviceID).data().set("state", LED);

		console.log(res);

        /* Got the response */
        switch(res.code) {
            case "DEVICE-DATA-UPDATED":
                /* Updated the device state successfully */
                console.log(`State Updated to ${LED? "ON": "OFF"}`);
                break;

            default:
                /* Failed to update the state */
                console.log("Failed to update the state");
        }
    }
    catch(err) {
        /*
            Error usually got generated when
            we are not connected to the internet
        */
        console.log("Network Error");
    }
}



/** Start the app */
start();

```

So in short, when the app loads it logs into the user account that we hard-coded. After logging in, it establishes the communication channel with the Cloud using the API key, access key and token. And when the button clicking calls theÂ `toggleLED`Â function, we send a request to the Cloud to update the state variable.

So we sent the data from the app to the Cloud, but our hardware device won't receive it unless it's listening for it. For this purpose, we'll use theÂ [Arduino SDK](https://github.com/grandeurtech/grandeurcloud-arduino-sdk/)of Grandeur. The code is as below: ðŸ¤–

The logic is very simple. We use the WiFi class to connect to the WiFi. Then we init the SDK with device ID, API key and the access token which we got in the first section. We listen to the Cloud for connection event â€“ as we did in the web app to keep track of connection status â€“ and data update event to toggle device pin as soon as an update from the web app arrives.


## Hardware Program

So we sent the data from the app to the Cloud, but our hardware device won't receive it unless it's listening for it. For this purpose, we'll use the Arduino SDK of Grandeur. The code is as below: ðŸ¤–

```cpp

/* Including the SDK and WiFi library */
#include <Grandeur.h>
#include <ESP8266WiFi.h>

/* Configurations */
String deviceID = "YOUR-DEVICE-ID";
String apiKey = "YOUR-APIKEY";
String token = "YOUR-ACCESS-TOKEN";

/* WiFi credentials */
String ssid = "WIFI-SSID";
String password = "WIFI-PASSWORD";

/* Create variable to hold project and device */
Grandeur::Project project;
Grandeur::Project::Device device;

/* Function to check device's connection status */
void onConnection(bool status) {
  switch(status) {
        case CONNECTED:
          /* Device connected to the cloud */
          
          Serial.println("Device is connected to the cloud.");
          return;

        case DISCONNECTED:
          /* Device disconnected from cloud */

          Serial.println("Device is disconnected from the cloud.");
          return;
  }
}

/* Function to handle state update event */
void updateHandler(const char* path, int state) {
    /* Print state */
    Serial.printf("Updated state is %d\n", state);
    
    /* Update pin level */
    digitalWrite(LED_BUILTIN, !state);
}

/* Function to connect to WiFi */
void connectWiFi() {
    /* Set mode to station */
    WiFi.mode(WIFI_STA);

    /* Connect using the ssid and password */
    WiFi.begin(ssid, password);

    /* Block till the WiFi is connected */
    while (WiFi.status() != WL_CONNECTED) {
         delay(500);
         Serial.print(".");
    }
    
    /* Print message */
    Serial.println("");
    Serial.println("WiFi connected");

    /* And IP address */
    Serial.println(WiFi.localIP());
}

void setup() {
    /* Begin the serial */
    Serial.begin(9600);

    /* Connect to WiFi */
    connectWiFi();
    
    /* Initializes the global object "grandeur" with your configurations. */
    project = grandeur.init(apiKey, token);
    
    /* Get reference to device */
    device = project.device(deviceID);
    
    /* Sets connection state update handler */
    project.onConnection(onConnection);
    
    /* Add event handler on state variable */
    device.data().on("state", updateHandler);
    
    /* Set mode of LED to output */
    pinMode(2, OUTPUT);

    /* Turn the LED off by default */
    digitalWrite(2, 0);    
}

void loop() {
    /* 
        Synchronizes the SDK with the cloud
        SDK will loop till we are connected to WiFi    
    */
    project.loop(WiFi.status() == WL_CONNECTED);
}

```

The logic is very simple. We use the WiFi class to connect to the WiFi. Then we init the SDK with device ID, API key and the access token which we got in the first section. We listen to the Cloud for connection event â€“ as we did in the web app to keep track of connection status â€“ and data update event to toggle the device pin as soon as an update from the web app arrives.


## Testing Locally

Here we are finally. Let's test what we have build. We go to run our web app to send the data. For that we run a local server with the live server extension of our editing environment.

>> `Live Server` is the go-to option in VS Code. Just install the extension and you can see a ** Go Live ** icon appear at the bottom. 

But there's a security measure. You cannot send data from your app to the Cloud unless you whitelist your domain in the settings section. Your domain is the address that is shown in the browser's URL bar when you open your app. This prevents all the unidentified sources from accessing your Cloud project's data in case you lose your access key.


#



